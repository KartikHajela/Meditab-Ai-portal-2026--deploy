<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="icon" href="{{ url_for('static', path='media/favicon.ico') }}">
    <meta charset="UTF-8">
    <title>Profile Settings - Meditab</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" rel="stylesheet" />
    
    <link rel="stylesheet" href="{{ url_for('static', path='css/home_styles.css') }}">
    
    <style>
        /* --- STUDIO VARIABLES --- */
        :root {
            --surface-1: #ffffff;
            --surface-2: #f8f9fa;
            --surface-3: #f1f3f4;
            --surface-hover: #f5f5f5;
            --border-subtle: rgba(0, 0, 0, 0.08);
            --shadow-studio: 0 4px 24px rgba(0, 0, 0, 0.04);
            --shadow-hover: 0 8px 32px rgba(66, 133, 244, 0.12);
            --glass-bg: rgba(255, 255, 255, 0.85);
            --glass-border: rgba(255, 255, 255, 0.5);
            --radius-lg: 20px;
            --radius-md: 12px;
            --radius-sm: 8px;
        }

        /* Dark Mode Adjustments */
        @media (prefers-color-scheme: dark) {
            :root {
                --surface-1: #1e1f20;
                --surface-2: #28292a;
                --surface-3: #3c4043;
                --border-subtle: rgba(255, 255, 255, 0.1);
                --glass-bg: rgba(30, 31, 32, 0.85);
                --glass-border: rgba(255, 255, 255, 0.1);
            }
        }

        body { background: var(--bg-body); }

        /* --- LAYOUT & ANIMATION --- */
        .profile-wrapper {
            max-width: 960px;
            margin: 0 auto;
            padding: 40px 24px 100px 24px;
            animation: fadeSlideUp 0.6s cubic-bezier(0.16, 1, 0.3, 1);
        }

        @keyframes fadeSlideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* --- STUDIO CARDS --- */
        .studio-card {
            background: var(--surface-1);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-lg);
            padding: 32px;
            margin-bottom: 24px;
            box-shadow: var(--shadow-studio);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .studio-card:hover {
            box-shadow: var(--shadow-studio), 0 0 0 1px var(--border-subtle);
        }

        /* Special Card: Critical Medical Info */
        .studio-card.critical {
            background: linear-gradient(to bottom right, var(--surface-1), #fff5f5);
            border-left: 4px solid #d93025;
        }
        @media (prefers-color-scheme: dark) {
            .studio-card.critical { background: linear-gradient(to bottom right, var(--surface-1), #2d1f1f); }
        }

        /* Special Card: Doctor Professional */
        .studio-card.professional {
            border-left: 4px solid #4285f4;
            background: linear-gradient(to bottom right, var(--surface-1), #f0f7ff);
        }
        @media (prefers-color-scheme: dark) {
            .studio-card.professional { background: linear-gradient(to bottom right, var(--surface-1), #1a2333); }
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 24px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border-subtle);
        }

        .header-icon-box {
            width: 40px; height: 40px;
            border-radius: 12px;
            background: var(--surface-3);
            display: flex; align-items: center; justify-content: center;
            color: var(--text-main);
        }
        .studio-card.critical .header-icon-box { background: #fce8e6; color: #d93025; }
        .studio-card.professional .header-icon-box { background: #e8f0fe; color: #4285f4; }

        .header-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-main);
            letter-spacing: -0.01em;
        }

        /* --- INPUTS & FORMS --- */
        .form-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 24px; }
        .form-grid.three { grid-template-columns: repeat(3, 1fr); }
        .full-span { grid-column: 1 / -1; }

        .input-group { display: flex; flex-direction: column; gap: 8px; }
        
        .input-label {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--text-sub);
            margin-left: 4px;
        }

        .studio-input {
            width: 100%;
            padding: 14px 16px;
            border-radius: var(--radius-md);
            border: 1px solid transparent; 
            background: var(--surface-2);
            color: var(--text-main);
            font-family: inherit;
            font-size: 0.95rem;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .studio-input:hover { background: var(--surface-hover); }
        
        .studio-input:focus {
            background: var(--surface-1);
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(66, 133, 244, 0.1);
            outline: none;
        }

        textarea.studio-input { resize: vertical; min-height: 100px; line-height: 1.6; }

        /* --- VISUAL WIDGETS --- */
        
        /* Avatar Upload */
        .avatar-uploader {
            display: flex; align-items: center; gap: 20px;
            margin-bottom: 30px;
        }
        .avatar-preview {
            width: 80px; height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, #4285f4, #d96570);
            display: flex; align-items: center; justify-content: center;
            color: white; font-size: 2rem; font-weight: 700;
            box-shadow: var(--shadow-studio);
            position: relative;
        }
        .edit-badge {
            position: absolute; bottom: 0; right: 0;
            background: var(--text-main); color: var(--bg-body);
            width: 28px; height: 28px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            border: 3px solid var(--surface-1);
            cursor: pointer; transition: transform 0.2s;
        }
        .edit-badge:hover { transform: scale(1.1); }

        /* BMI Visualizer */
        .bmi-container {
            background: var(--surface-2);
            border-radius: var(--radius-md);
            padding: 20px;
            margin-top: 10px;
        }
        .bmi-scale {
            height: 8px;
            border-radius: 4px;
            background: linear-gradient(90deg, #81d4fa 0%, #4caf50 30%, #4caf50 50%, #ffb74d 70%, #ef5350 100%);
            margin: 10px 0;
            position: relative;
        }
        .bmi-marker {
            position: absolute; top: -4px; width: 16px; height: 16px;
            background: #fff; border: 3px solid var(--text-main);
            border-radius: 50%;
            transform: translateX(-50%);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            transition: left 0.5s cubic-bezier(0.16, 1, 0.3, 1);
        }

        /* --- STICKY GLASS BAR --- */
        .glass-action-bar {
            position: fixed;
            bottom: 30px; left: 50%;
            transform: translateX(-50%);
            background: var(--glass-bg);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid var(--glass-border);
            padding: 10px 10px 10px 24px;
            border-radius: 100px;
            display: flex;
            align-items: center;
            gap: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            z-index: 100;
            max-width: 90%;
            width: fit-content;
            animation: slideUpFade 0.8s 0.2s backwards;
        }
        @keyframes slideUpFade { from{opacity:0; transform:translate(-50%, 20px);} to{opacity:1; transform:translate(-50%, 0);} }

        .progress-circle {
            width: 24px; height: 24px;
            border-radius: 50%;
            background: conic-gradient(var(--primary) var(--pct), var(--border-subtle) 0);
            display: flex; align-items: center; justify-content: center;
        }
        .progress-inner { width: 18px; height: 18px; background: var(--glass-bg); border-radius: 50%; }

        .btn-studio {
            background: var(--text-main);
            color: var(--bg-body);
            border: none;
            padding: 12px 32px;
            border-radius: 100px;
            font-weight: 600;
            font-size: 0.95rem;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            display: flex; align-items: center; gap: 8px;
        }
        .btn-studio:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .form-grid, .form-grid.three { grid-template-columns: 1fr; }
            .profile-wrapper { padding: 20px; }
            .glass-action-bar { width: 90%; justify-content: space-between; bottom: 20px; }
        }
    </style>
</head>
<body>

    <div class="app-layout">
        
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="brand-title">
                    <svg class="brand-logo" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 182 182"><path d="M91 0C40.7 0 0 40.7 0 91s40.7 91 91 91 91-40.7 91-91S141.3 0 91 0z" fill="currentColor"/></svg>
                    <span>Meditab Portal</span>
                </div>
            </div>
            
            <div style="padding: 0 10px; margin-top: 20px;">
                <div style="font-size: 0.75rem; font-weight: 700; color: var(--text-sub); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 10px;">Account</div>
                <div class="sidebar-file-item" style="background: var(--bg-hover);">
                    <span class="material-symbols-outlined file-icon-small" style="color:var(--primary)">person</span>
                    <span class="file-name-small" style="font-weight: 600;">Profile Settings</span>
                </div>
                <a href="{{ '/app/' + user_hash }}" style="text-decoration:none;">
                    <div class="sidebar-file-item">
                        <span class="material-symbols-outlined file-icon-small">chat_bubble</span>
                        <span class="file-name-small">Back to Chat</span>
                    </div>
                </a>
            </div>

            <div style="flex:1"></div>

            <div class="sidebar-footer">
                <div class="user-profile">
                    <div class="avatar-small">{{ profile.full_name[0] if profile.full_name else 'U' }}</div>
                    <div style="font-size: 0.9rem; font-weight: 500;">{{ profile.full_name or 'User' }}</div>
                </div>
            </div>
        </aside>

        <main class="main-content custom-scroll" style="overflow-y: auto; background: var(--bg-body);">
            
            <div class="profile-wrapper">
                
                <div style="margin-bottom: 40px;">
                    <h1 class="gradient-text" style="font-size: 2.5rem; margin-bottom: 8px;">Profile & Health</h1>
                    <p style="color: var(--text-sub); font-size: 1.05rem; max-width: 600px;">
                        Manage your personal identity and clinical baseline to help our AI provide safer, more accurate medical assistance.
                    </p>
                </div>

                <form id="profileForm" onsubmit="saveProfile(event, '{{ user_id }}')">
                    
                    <div class="studio-card">
                        <div class="card-header">
                            <div class="header-icon-box"><span class="material-symbols-outlined">badge</span></div>
                            <div class="header-title">Identity & Administrative</div>
                        </div>

                        <div class="avatar-uploader">
                            <div class="avatar-preview">
                                {{ profile.full_name[0] if profile.full_name else 'U' }}
                                <label class="edit-badge">
                                    <span class="material-symbols-outlined" style="font-size: 14px;">edit</span>
                                    <input type="file" hidden accept="image/*">
                                </label>
                            </div>
                            <div>
                                <h3 style="margin:0; font-size:1.1rem; color: var(--text-main);">{{ profile.full_name or 'New User' }}</h3>
                                <p style="margin:4px 0 0; color: var(--text-sub); font-size: 0.9rem;">{{ user_role }} Account</p>
                            </div>
                        </div>

                        <div class="form-grid">
                            <div class="input-group">
                                <label class="input-label">Full Name</label>
                                <input type="text" name="full_name" class="studio-input" value="{{ profile.full_name or '' }}" placeholder="Legal Name">
                            </div>
                            <div class="input-group">
                                <label class="input-label">Date of Birth</label>
                                <input type="date" name="date_of_birth" class="studio-input" value="{{ profile.date_of_birth or '' }}">
                            </div>
                            <div class="input-group">
                                <label class="input-label">Phone Number</label>
                                <input type="tel" name="phone" class="studio-input" value="{{ profile.phone or '' }}" placeholder="+91 00000 00000">
                            </div>
                            <div class="input-group">
                                <label class="input-label">Gender</label>
                                <select name="gender" class="studio-input">
                                    <option value="">Select Gender...</option>
                                    <option value="Male" {% if profile.gender == 'Male' %}selected{% endif %}>Male</option>
                                    <option value="Female" {% if profile.gender == 'Female' %}selected{% endif %}>Female</option>
                                    <option value="Other" {% if profile.gender == 'Other' %}selected{% endif %}>Other</option>
                                </select>
                            </div>
                            <div class="input-group full-span">
                                <label class="input-label">Home Address</label>
                                <input type="text" name="address" class="studio-input" value="{{ profile.address or '' }}" placeholder="Street Address, City, Zip Code">
                            </div>
                        </div>
                    </div>

                    <div class="studio-card">
                        <div class="card-header">
                            <div class="header-icon-box"><span class="material-symbols-outlined">emergency</span></div>
                            <div class="header-title">Emergency Contact</div>
                        </div>
                        <div class="form-grid three">
                            <div class="input-group">
                                <label class="input-label">Contact Name</label>
                                <input type="text" name="emergency_name" class="studio-input" value="{{ profile.emergency_name or '' }}" placeholder="Guardian/Spouse">
                            </div>
                            <div class="input-group">
                                <label class="input-label">Relationship</label>
                                <input type="text" name="emergency_relation" class="studio-input" value="{{ profile.emergency_relation or '' }}" placeholder="e.g. Mother">
                            </div>
                            <div class="input-group">
                                <label class="input-label">Emergency Phone</label>
                                <input type="tel" name="emergency_phone" class="studio-input" value="{{ profile.emergency_phone or '' }}" placeholder="Primary Number">
                            </div>
                        </div>
                    </div>

                    <div class="studio-card">
                        <div class="card-header">
                            <div class="header-icon-box"><span class="material-symbols-outlined">vital_signs</span></div>
                            <div class="header-title">Clinical Baseline</div>
                        </div>

                        <div class="form-grid three">
                            <div class="input-group">
                                <label class="input-label">Blood Group</label>
                                <select name="blood_group" class="studio-input">
                                    <option value="">Select...</option>
                                    <option value="A+" {% if profile.blood_group == 'A+' %}selected{% endif %}>A+</option>
                                    <option value="O+" {% if profile.blood_group == 'O+' %}selected{% endif %}>O+</option>
                                    <option value="B+" {% if profile.blood_group == 'B+' %}selected{% endif %}>B+</option>
                                    <option value="AB+" {% if profile.blood_group == 'AB+' %}selected{% endif %}>AB+</option>
                                    <option value="A-" {% if profile.blood_group == 'A-' %}selected{% endif %}>A-</option>
                                    <option value="O-" {% if profile.blood_group == 'O-' %}selected{% endif %}>O-</option>
                                    <option value="B-" {% if profile.blood_group == 'B-' %}selected{% endif %}>B-</option>
                                    <option value="AB-" {% if profile.blood_group == 'AB-' %}selected{% endif %}>AB-</option>
                                </select>
                            </div>
                            <div class="input-group">
                                <label class="input-label">Height (cm)</label>
                                <input type="number" id="heightInput" name="height" class="studio-input" value="{{ profile.height or '' }}" placeholder="170">
                            </div>
                            <div class="input-group">
                                <label class="input-label">Weight (kg)</label>
                                <input type="number" id="weightInput" name="weight" class="studio-input" value="{{ profile.weight or '' }}" placeholder="70">
                            </div>
                        </div>

                        <div class="bmi-container">
                            <div style="display: flex; justify-content: space-between; font-size: 0.85rem; font-weight: 600; color: var(--text-sub); margin-bottom: 5px;">
                                <span>BMI Analysis</span>
                                <span id="bmiText" style="color: var(--text-main);">--</span>
                            </div>
                            <div class="bmi-scale">
                                <div id="bmiMarker" class="bmi-marker" style="left: 0%;"></div>
                            </div>
                            <div style="display: flex; justify-content: space-between; font-size: 0.75rem; color: var(--text-sub); opacity: 0.7;">
                                <span>15</span>
                                <span>18.5</span>
                                <span>25</span>
                                <span>30</span>
                                <span>40</span>
                            </div>
                        </div>
                    </div>

                    <div class="studio-card critical">
                        <div class="card-header">
                            <div class="header-icon-box"><span class="material-symbols-outlined">warning</span></div>
                            <div class="header-title" style="color: #d93025;">Critical History</div>
                        </div>
                        
                        <div class="form-grid">
                            <div class="input-group full-span">
                                <label class="input-label" style="color: #d93025;">Known Allergies (Severe)</label>
                                <textarea name="allergies" class="studio-input" placeholder="e.g. Penicillin (Anaphylaxis), Peanuts, Latex">{{ profile.allergies or '' }}</textarea>
                            </div>
                            <div class="input-group full-span">
                                <label class="input-label">Chronic Conditions</label>
                                <textarea name="conditions" class="studio-input" placeholder="e.g. Type 2 Diabetes, Hypertension, Asthma">{{ profile.conditions or '' }}</textarea>
                            </div>
                            <div class="input-group full-span">
                                <label class="input-label">Current Medications</label>
                                <textarea name="medications" class="studio-input" placeholder="List active medications and dosages">{{ profile.medications or '' }}</textarea>
                            </div>
                            
                            <div class="input-group">
                                <label class="input-label">Surgical History</label>
                                <textarea name="surgical_history" class="studio-input" placeholder="Major surgeries & years">{{ profile.surgical_history or '' }}</textarea>
                            </div>
                            <div class="input-group">
                                <label class="input-label">Family Medical History</label>
                                <textarea name="family_medical_history" class="studio-input" placeholder="Hereditary conditions (Heart disease, Cancer, etc.)">{{ profile.family_medical_history or '' }}</textarea>
                            </div>
                        </div>
                    </div>

                    <div class="studio-card">
                        <div class="card-header">
                            <div class="header-icon-box"><span class="material-symbols-outlined">self_improvement</span></div>
                            <div class="header-title">Lifestyle & Occupation</div>
                        </div>
                        <div class="form-grid">
                            <div class="input-group">
                                <label class="input-label">Smoking / Alcohol</label>
                                <select name="lifestyle_status" class="studio-input">
                                    <option value="None" {% if profile.lifestyle_status == 'None' %}selected{% endif %}>Non-Smoker / Non-Drinker</option>
                                    <option value="Social" {% if profile.lifestyle_status == 'Social' %}selected{% endif %}>Social Drinker</option>
                                    <option value="Moderate" {% if profile.lifestyle_status == 'Moderate' %}selected{% endif %}>Moderate</option>
                                    <option value="Heavy" {% if profile.lifestyle_status == 'Heavy' %}selected{% endif %}>Heavy</option>
                                </select>
                            </div>
                            <div class="input-group">
                                <label class="input-label">Occupation</label>
                                <input type="text" name="occupation" class="studio-input" value="{{ profile.occupation or '' }}" placeholder="Current Job Title">
                            </div>
                            <div class="input-group full-span">
                                <label class="input-label">Insurance Provider & Policy</label>
                                <input type="text" name="insurance_details" class="studio-input" value="{{ profile.insurance_provider or '' }}" placeholder="e.g. LIC #123456789">
                            </div>
                        </div>
                    </div>

                    {% if user_role == 'DOCTOR' %}
                    <div class="studio-card professional">
                        <div class="card-header">
                            <div class="header-icon-box"><span class="material-symbols-outlined">medical_services</span></div>
                            <div class="header-title" style="color: #4285f4;">Professional Details</div>
                        </div>
                        <div class="form-grid">
                            <div class="input-group">
                                <label class="input-label">Specialty</label>
                                <select name="specialty" class="studio-input">
                                    {% for spec in specialties %}
                                    <option value="{{ spec.value }}" {% if doctor_profile.specialty == spec %}selected{% endif %}>{{ spec.value }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="input-group">
                                <label class="input-label">Availability</label>
                                <select name="is_available" class="studio-input">
                                    <option value="true" {% if doctor_profile.is_available %}selected{% endif %}>Available for Cases</option>
                                    <option value="false" {% if not doctor_profile.is_available %}selected{% endif %}>Busy / Offline</option>
                                </select>
                            </div>
                            <div class="input-group full-span">
                                <label class="input-label">Professional Bio</label>
                                <textarea name="bio" class="studio-input" placeholder="Brief description of your expertise...">{{ doctor_profile.bio or '' }}</textarea>
                            </div>
                        </div>
                    </div>
                    {% endif %}

                    <div class="glass-action-bar">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <div class="progress-circle" id="progressRing" style="--pct: conic-gradient(var(--primary) 0%, var(--border-subtle) 0);">
                                <div class="progress-inner"></div>
                            </div>
                            <div style="font-size: 0.85rem; color: var(--text-sub);">
                                <strong style="color: var(--text-main);" id="progressText">0%</strong> Complete
                            </div>
                        </div>
                        
                        <div style="width: 1px; height: 24px; background: var(--border-subtle);"></div>

                        <button type="submit" class="btn-studio">
                            Save Changes
                        </button>
                    </div>

                </form>
            </div>
        </main>
    </div>

    <script>
        // --- STUDIO LOGIC ---

        // 1. BMI Visualizer
        const hInput = document.getElementById('heightInput');
        const wInput = document.getElementById('weightInput');
        const bmiMarker = document.getElementById('bmiMarker');
        const bmiText = document.getElementById('bmiText');

        function updateBMI() {
            const h = parseFloat(hInput.value) / 100; // cm to m
            const w = parseFloat(wInput.value);
            
            if(h > 0 && w > 0) {
                const bmi = (w / (h * h)).toFixed(1);
                
                // Calculate visual position (Scale: 15 to 40)
                let percentage = ((bmi - 15) / (40 - 15)) * 100;
                percentage = Math.max(0, Math.min(100, percentage)); // Clamp 0-100
                
                bmiMarker.style.left = percentage + '%';
                
                let label = "Normal";
                let color = "#4caf50";
                
                if(bmi < 18.5) { label = "Underweight"; color = "#81d4fa"; }
                else if(bmi >= 25 && bmi < 30) { label = "Overweight"; color = "#ffb74d"; }
                else if(bmi >= 30) { label = "Obese"; color = "#ef5350"; }
                else { label = "Healthy"; color = "#4caf50"; }

                bmiText.innerHTML = `${bmi} <span style="color:${color}; font-weight:600; margin-left:4px;">${label}</span>`;
            } else {
                bmiText.innerText = "--";
                bmiMarker.style.left = "0%";
            }
        }
        hInput.addEventListener('input', updateBMI);
        wInput.addEventListener('input', updateBMI);
        updateBMI();

        // 2. Circular Progress Logic
        function updateProgress() {
            const inputs = document.querySelectorAll('input:not([type="hidden"]), select, textarea');
            let filled = 0, total = 0;
            inputs.forEach(i => {
                total++;
                if(i.value.trim() !== '') filled++;
            });
            const pct = Math.round((filled / total) * 100);
            
            // Update Text
            document.getElementById('progressText').innerText = pct + '%';
            
            // Update Ring CSS Variable
            const ring = document.getElementById('progressRing');
            ring.style.setProperty('--pct', `conic-gradient(var(--primary) ${pct}%, var(--border-subtle) 0)`);
        }
        
        document.querySelectorAll('input, select, textarea').forEach(el => {
            el.addEventListener('input', updateProgress);
        });
        updateProgress();

        // 3. Smooth Save
        async function saveProfile(e, userId) {
            e.preventDefault();
            const btn = document.querySelector('.btn-studio');
            const originalContent = btn.innerHTML;
            
            btn.innerHTML = `<span class="material-symbols-outlined" style="animation:spin 1s linear infinite; font-size:18px;">sync</span> Saving...`;
            btn.style.opacity = "0.8";
            
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData.entries());

            try {
                // Simulate network for effect
                await new Promise(r => setTimeout(r, 600));

                const res = await fetch(`/users/${userId}/profile/update`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(data)
                });

                if(res.ok) {
                    btn.style.background = "#1e8e3e";
                    btn.innerHTML = `<span class="material-symbols-outlined" style="font-size:18px;">check</span> Saved`;
                    setTimeout(() => {
                        btn.style.background = ""; // Reset to CSS default
                        btn.style.opacity = "1";
                        btn.innerHTML = originalContent;
                    }, 2000);
                } else { throw new Error(); }
            } catch(err) {
                btn.style.background = "#d93025";
                btn.innerHTML = "Error";
                setTimeout(() => {
                    btn.style.background = "";
                    btn.style.opacity = "1";
                    btn.innerHTML = originalContent;
                }, 2000);
            }
        }
    </script>
    <style>@keyframes spin { 100% { transform: rotate(360deg); } }</style>
</body>
</html>