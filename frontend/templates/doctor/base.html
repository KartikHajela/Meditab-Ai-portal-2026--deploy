<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meditab Pro | Physician Console</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@500&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,1,0" rel="stylesheet" />
    
    <link rel="stylesheet" href="{{ url_for('static', path='css/home_styles.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', path='css/docDash_styles.css') }}">
</head>
<body>

    <div class="app-layout">
        
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="brand-title">
                    <span class="material-symbols-rounded" style="color:var(--primary); font-size:28px;">local_hospital</span>
                    <span style="font-size: 1.2rem; letter-spacing: -0.5px;">Meditab Pro</span>
                </div>
            </div>

            <div class="sidebar-scroll-content custom-scroll">
                
                <div class="group-label">Console</div>
                
                <div class="sidebar-file-item nav-item active" onclick="app.navTo('dashboard')" id="nav-dashboard">
                    <span class="material-symbols-rounded file-icon-small">grid_view</span>
                    <span class="file-name-small">Command Center</span>
                </div>
                
                <div class="sidebar-file-item nav-item" onclick="app.navTo('profile')" id="nav-profile">
                    <span class="material-symbols-rounded file-icon-small">badge</span>
                    <span class="file-name-small">My Performance</span>
                </div>

                <div class="sidebar-file-item nav-item" onclick="app.navTo('schedule')">
                    <span class="material-symbols-rounded file-icon-small">calendar_month</span>
                    <span class="file-name-small">Schedule & Shifts</span>
                </div>

                <div class="group-label" style="margin-top:24px; display:flex; justify-content:space-between; align-items:center;">
                    <span>Live Triage</span>
                    <span class="live-indicator"><span class="blink-dot"></span> Live</span>
                </div>
                
                <div class="files-widget" id="triageList">
                    </div>

            </div>

            <div class="sidebar-footer">
                <div class="user-profile" onclick="app.navTo('profile')">
                    <div class="avatar-small">DR</div>
                    <div>
                        <div style="font-size: 0.85rem; font-weight: 600;">Dr. Alexander Smith</div>
                        <div style="font-size: 0.7rem; color: #10b981; display:flex; align-items:center; gap:4px;">
                            <div class="connection-dot online"></div> Online
                        </div>
                    </div>
                </div>
            </div>
        </aside>

        <main class="main-content">
            
            <header class="top-bar">
                <div style="display: flex; align-items: center; gap: 16px;">
                    <button class="mobile-menu-btn" onclick="toggleSidebar()">
                        <span class="material-symbols-rounded">menu</span>
                    </button>
                    <div class="chat-title" id="pageTitle" style="font-size:1.1rem;">Command Center</div>
                </div>
                
                <div style="display: flex; align-items: center; gap: 16px;">
                    <div class="shift-timer">
                        <span class="material-symbols-rounded" style="font-size:16px; color:var(--text-sub)">schedule</span>
                        <span id="shiftClock" style="font-family:'JetBrains Mono'; font-size:0.85rem;">04:20:10</span>
                    </div>

                    <button class="mini-action-pill" id="statusBtn" onclick="app.toggleAvailability(this)" 
                            style="display:flex; align-items:center; gap:8px; border:1px solid var(--border); background:var(--bg-body);">
                        <span class="material-symbols-rounded" style="font-size:14px; color:#10b981;">fiber_manual_record</span>
                        <span>Accepting Requests</span>
                    </button>

                    <div class="header-avatar">
                        <span class="material-symbols-rounded">notifications</span>
                        <span class="notification-badge">3</span>
                    </div>
                </div>
            </header>

            <div id="view-dashboard" class="view-container active dash-container custom-scroll">
                
                <div class="dash-left-col">
                    <div class="stat-grid">
                        <div class="stat-card" style="border-left: 4px solid #0284c7;">
                            <div class="stat-icon-wrapper" style="background: #e0f2fe; color: #0284c7;">
                                <span class="material-symbols-rounded">personal_injury</span>
                            </div>
                            <div>
                                <div class="stat-value">8</div>
                                <div class="stat-label">Waiting Room</div>
                            </div>
                        </div>
                        <div class="stat-card" style="border-left: 4px solid #db2777;">
                            <div class="stat-icon-wrapper" style="background: #fce7f3; color: #db2777;">
                                <span class="material-symbols-rounded">monitor_heart</span>
                            </div>
                            <div>
                                <div class="stat-value">3</div>
                                <div class="stat-label">Critical Vitals</div>
                            </div>
                        </div>
                        <div class="stat-card" style="border-left: 4px solid #16a34a;">
                            <div class="stat-icon-wrapper" style="background: #dcfce7; color: #16a34a;">
                                <span class="material-symbols-rounded">check_circle</span>
                            </div>
                            <div>
                                <div class="stat-value">12</div>
                                <div class="stat-label">Discharged</div>
                            </div>
                        </div>
                        <div class="stat-card" style="border-left: 4px solid #ea580c;">
                            <div class="stat-icon-wrapper" style="background: #ffedd5; color: #ea580c;">
                                <span class="material-symbols-rounded">emergency</span>
                            </div>
                            <div>
                                <div class="stat-value">2</div>
                                <div class="stat-label">Incoming EMS</div>
                            </div>
                        </div>
                    </div>

                    <div class="panel-card" style="flex:1; display:flex; flex-direction:column;">
                        <div class="panel-header">
                            <div class="panel-title">
                                <span class="material-symbols-rounded" style="color:var(--text-sub)">queue_music</span> 
                                Patient Queue
                            </div>
                            <div style="display:flex; gap:8px;">
                                <button class="mini-action-pill" onclick="app.refreshTriage()">Refresh</button>
                                <button class="mini-action-pill"><span class="material-symbols-rounded" style="font-size:16px">filter_list</span> Filter</button>
                            </div>
                        </div>
                        <div style="flex:1; overflow-y:auto;">
                            <table class="triage-table">
                                <thead>
                                    <tr>
                                        <th>Status</th>
                                        <th>Patient Name</th>
                                        <th>Chief Complaint (AI Summary)</th>
                                        <th>Wait Time</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody id="triageTableBody">
                                    </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="dash-right-col">
                    <div class="panel-card" style="flex:1; display:flex; flex-direction:column;">
                        <div class="panel-header">
                            <div class="panel-title">
                                <span class="material-symbols-rounded">history</span> Department Activity
                            </div>
                        </div>
                        <div style="padding:0; overflow-y:auto;" id="activityFeed">
                            <div class="feed-item">
                                <span class="material-symbols-rounded feed-icon" style="background:#dcfce7; color:#16a34a;">lab_research</span>
                                <div>
                                    <div class="feed-text"><strong>Lab Results</strong> ready for Patient #102</div>
                                    <div class="feed-time">2m ago</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="view-workspace" class="view-container workspace-layout" style="display:none;">
                
                <div class="ws-sidebar custom-scroll">
                    
                    <div class="patient-card">
                        <div class="patient-header">
                            <div class="avatar-lg" style="background:#4f46e5;">JD</div>
                            <div>
                                <h2 style="margin:0; font-size:1.2rem;">John Doe</h2>
                                <div style="color:var(--text-sub); font-size:0.85rem;">ID: #101 ‚Ä¢ 54 Male ‚Ä¢ O+</div>
                            </div>
                        </div>
                        <div class="info-grid">
                            <div class="info-tile">
                                <span class="lbl">Heart Rate</span>
                                <span class="val danger">110 bpm</span>
                            </div>
                            <div class="info-tile">
                                <span class="lbl">BP</span>
                                <span class="val warning">150/95</span>
                            </div>
                            <div class="info-tile">
                                <span class="lbl">Temp</span>
                                <span class="val">99.1¬∞F</span>
                            </div>
                            <div class="info-tile">
                                <span class="lbl">SpO2</span>
                                <span class="val">98%</span>
                            </div>
                        </div>
                        <div style="margin-top:12px;">
                            <span class="badge" style="background:#fee2e2; color:#ef4444; border:1px solid #fecaca;">Allergy: Penicillin</span>
                        </div>
                    </div>

                    <div class="ai-consult-wrapper">
                        <div class="ai-consult-header">
                            <span class="material-symbols-rounded" style="font-size:16px;">psychology</span>
                            AI Context Analysis
                        </div>
                        
                        <div id="aiConsultLog" class="ai-chat-log custom-scroll">
                            <div class="ai-msg-row">
                                <div class="ai-avatar"><span class="material-symbols-rounded">smart_toy</span></div>
                                <div class="ai-bubble">
                                    Hello Dr. Smith. I have analyzed John's chat history with the patient bot. 
                                    <strong>Flag:</strong> He mentioned "radiating jaw pain" 2 days ago which is not in today's intake form.
                                </div>
                            </div>
                        </div>

                        <div class="ai-input-area">
                            <div class="input-group">
                                <input type="text" id="aiConsultInput" placeholder="Query patient history..." 
                                       onkeypress="if(event.key === 'Enter') app.sendAiConsult()">
                                <button onclick="app.sendAiConsult()">
                                    <span class="material-symbols-rounded">send</span>
                                </button>
                            </div>
                            <div class="quick-chips custom-scroll">
                                <button onclick="app.quickAsk('Summarize symptoms')">Summarize</button>
                                <button onclick="app.quickAsk('Check interactions')">Interactions</button>
                                <button onclick="app.quickAsk('Show timeline')">Timeline</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="ws-main custom-scroll">
                    
                    <div class="clinical-tabs">
                        <button class="tab-btn active" onclick="app.switchTab('notes', this)">Clinical Notes</button>
                        <button class="tab-btn" onclick="app.switchTab('rx', this)">Rx & Plan</button>
                        <button class="tab-btn" onclick="app.switchTab('history', this)">Visit History</button>
                    </div>

                    <div id="tab-notes" class="tab-content active">
                        <div class="editor-container">
                            <div class="editor-header">
                                <h3 style="margin:0;">Encounter Note</h3>
                                <div style="display:flex; gap:8px;">
                                    <button class="mini-action-pill" onclick="app.insertTemplate()">+ SOAP Template</button>
                                    <button class="mini-action-pill" onclick="app.generateReportPreview()" style="color:var(--primary); border-color:var(--primary);">
                                        <span class="material-symbols-rounded">print</span> Report
                                    </button>
                                </div>
                            </div>
                            
                            <div class="editor-toolbar">
                                <button class="tool-btn"><span class="material-symbols-rounded">format_bold</span></button>
                                <button class="tool-btn"><span class="material-symbols-rounded">format_italic</span></button>
                                <button class="tool-btn"><span class="material-symbols-rounded">format_list_bulleted</span></button>
                                <div style="width:1px; height:20px; background:var(--border); margin:0 8px;"></div>
                                <button class="tool-btn"><span class="material-symbols-rounded">mic</span></button>
                            </div>
                            
                            <textarea id="clinicalNoteInput" class="clinical-textarea" placeholder="Start typing..."></textarea>
                        </div>
                    </div>

                    <div id="tab-rx" class="tab-content">
                        <div class="rx-wrapper">
                            
                            <div class="suggestion-block">
                                <h4 style="color:#9b72cb; display:flex; align-items:center; gap:8px; margin-bottom:12px;">
                                    <span class="material-symbols-rounded">auto_awesome</span> AI Recommendations
                                </h4>
                                <div id="aiRxList">
                                    </div>
                            </div>

                            <hr class="divider">

                            <div class="final-rx-block">
                                <h4>Final Prescription Plan</h4>
                                <div id="finalRxList" class="final-list-box">
                                    <div class="empty-state">No medications added yet. Accept AI suggestions or add manually.</div>
                                </div>
                                
                                <div class="manual-add-row">
                                    <input type="text" id="manualDrug" placeholder="Drug Name" style="flex:2;">
                                    <input type="text" id="manualDose" placeholder="Dosage (e.g. 500mg BID)" style="flex:1;">
                                    <button onclick="app.addManualRx()">Add</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="tab-history" class="tab-content">
                        <div class="history-timeline">
                            <div class="timeline-item">
                                <div class="tl-date">Oct 24, 2025</div>
                                <div class="tl-content">
                                    <strong>General Checkup</strong>
                                    <p>Patient reported mild fatigue. BP 120/80. Labs ordered.</p>
                                </div>
                            </div>
                            <div class="timeline-item">
                                <div class="tl-date">Aug 10, 2025</div>
                                <div class="tl-content">
                                    <strong>Emergency Visit</strong>
                                    <p>Allergic reaction to peanuts. Administered Epinephrine.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="ws-footer">
                        <button class="modal-btn secondary" onclick="app.navTo('dashboard')">Save Draft</button>
                        <button class="modal-btn primary" onclick="app.finalizeCase()">
                            <span class="material-symbols-rounded">check_circle</span> Discharge & Sign
                        </button>
                    </div>

                </div>
            </div>

            <div id="view-profile" class="view-container custom-scroll" style="display:none;">
                <div style="max-width:1000px; margin:0 auto;">
                    
                    <div class="profile-header-card">
                        <div class="avatar-xl">DR</div>
                        <div style="flex:1;">
                            <h1 style="margin:0; font-size:2rem;">Dr. Alexander Smith</h1>
                            <p style="margin:4px 0 12px 0; color:var(--text-sub);">Chief Resident ‚Ä¢ Cardiology Dept ‚Ä¢ ID #9921</p>
                            <div style="display:flex; gap:10px;">
                                <span class="badge" style="background:#e0f2fe; color:#0369a1;">Top Rated</span>
                                <span class="badge" style="background:#f3e8ff; color:#7e22ce;">Quick Responder</span>
                            </div>
                        </div>
                        <div style="text-align:right;">
                            <div style="font-size:3rem; font-weight:700; color:var(--text-main);">4.9</div>
                            <div style="font-size:0.9rem; color:var(--text-sub);">Patient Satisfaction</div>
                        </div>
                    </div>

                    <h3 style="margin-bottom:16px;">Performance Analytics</h3>
                    <div class="stat-grid">
                        <div class="stat-card">
                            <div class="stat-value" style="color:#10b981;">1,240</div>
                            <div class="stat-label">Patients Treated</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">92%</div>
                            <div class="stat-label">Diagnostic Accuracy</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">12m</div>
                            <div class="stat-label">Avg Consult Time</div>
                        </div>
                    </div>

                    <h3 style="margin:24px 0 16px 0;">Achievements</h3>
                    <div style="display:grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap:16px;">
                        <div class="panel-card" style="padding:20px; text-align:center;">
                            <div style="font-size:40px; margin-bottom:10px;">‚ö°</div>
                            <div style="font-weight:600;">Lifesaver</div>
                            <div style="font-size:0.8rem; color:var(--text-sub);">50+ Critical Cases</div>
                        </div>
                        <div class="panel-card" style="padding:20px; text-align:center;">
                            <div style="font-size:40px; margin-bottom:10px;">üî¨</div>
                            <div style="font-weight:600;">Diagnostician</div>
                            <div style="font-size:0.8rem; color:var(--text-sub);">98% AI Agreement</div>
                        </div>
                        <div class="panel-card" style="padding:20px; text-align:center; opacity:0.5;">
                            <div style="font-size:40px; margin-bottom:10px; filter:grayscale(1);">üèÜ</div>
                            <div style="font-weight:600;">Dept Head</div>
                            <div style="font-size:0.8rem; color:var(--text-sub);">Locked (5k Patients)</div>
                        </div>
                    </div>

                </div>
            </div>

        </main>
    </div>

    <div class="dev-support-fab" onclick="app.openDevModal()" title="Report Bug / Request Feature">
        <span class="material-symbols-rounded">code</span>
    </div>

    <div id="toastContainer" class="toast-container"></div>

    <div id="devModal" class="modal-overlay">
        <div class="modal-box">
            <div class="panel-header" style="background:transparent; padding:0 0 16px 0; border:none;">
                <h3 style="margin:0;">Dev Support Line</h3>
                <span class="material-symbols-rounded" style="cursor:pointer" onclick="app.closeDevModal()">close</span>
            </div>
            <p style="font-size:0.9rem; color:var(--text-sub); margin-bottom:12px;">Direct line to system admins for bugs or features.</p>
            <textarea id="devTicketText" style="width:100%; height:120px; padding:12px; border-radius:8px; border:1px solid var(--border); background:var(--bg-input); margin-bottom:16px; font-family:inherit;" placeholder="Describe the issue..."></textarea>
            <div style="display:flex; justify-content:flex-end; gap:10px;">
                <button class="modal-btn secondary" onclick="app.closeDevModal()">Cancel</button>
                <button class="modal-btn primary" onclick="app.submitDevTicket()">Submit Ticket</button>
            </div>
        </div>
    </div>

    <div id="reportModal" class="modal-overlay">
        <div class="modal-box" style="width:700px; height:85vh; display:flex; flex-direction:column; max-width:95%;">
            <div class="panel-header" style="background:transparent; padding:0 0 16px 0; border-bottom:1px solid var(--border);">
                <h3 style="margin:0;">Final Medical Report Preview</h3>
                <span class="material-symbols-rounded" style="cursor:pointer" onclick="document.getElementById('reportModal').style.display='none'">close</span>
            </div>
            <div id="reportContent" class="custom-scroll" style="flex:1; overflow-y:auto; padding:30px; background:#fff; color:#000; font-family:'Times New Roman', serif;">
                </div>
            <div style="padding-top:16px; border-top:1px solid var(--border); display:flex; justify-content:flex-end; gap:12px;">
                <button class="modal-btn secondary" onclick="document.getElementById('reportModal').style.display='none'">Edit</button>
                <button class="modal-btn primary" onclick="app.printReport()">
                    <span class="material-symbols-rounded">print</span> Print / PDF
                </button>
            </div>
        </div>
    </div>

    <div id="blastModal" class="modal-overlay" style="z-index:10000;">
        <div class="blast-card">
            <span class="material-symbols-rounded" style="font-size: 48px; color: #d93025; margin-bottom:16px; animation: pulse 1s infinite;">warning</span>
            <h2 style="margin:0 0 8px 0; color:#d93025; text-transform:uppercase; letter-spacing:1px;">Critical Alert</h2>
            <p style="font-size:1.1rem; margin-bottom:24px;">Incoming High-Priority Case: <strong>Cardiac Arrest (ER-4)</strong></p>
            
            <div style="background:rgba(255,255,255,0.1); padding:16px; border-radius:8px; margin-bottom:24px; text-align:left;">
                <div style="font-size:0.8rem; opacity:0.7; text-transform:uppercase;">AI Triage Note</div>
                <div style="font-weight:500;">"Patient collapsed. No pulse initially. CPR in progress. ETA 2 mins."</div>
            </div>

            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:16px;">
                <button class="modal-btn secondary" style="background:transparent; border:1px solid #555; color:#fff;" onclick="app.closeBlast()">Busy / Decline</button>
                <button class="modal-btn primary" style="background:#d93025; color:white; border:none;" onclick="app.acceptBlast()">ACCEPT CASE</button>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', path='js/docDash.js') }}"></script>
</body>
</html>