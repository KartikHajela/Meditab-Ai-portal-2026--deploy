<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Chat Audit</title>
    <link href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" rel="stylesheet" />
    <style>
        :root {
            --bg-nav: #f0f4f9; --bg-chat: #ffffff; --text: #1f1f1f; --active: #d3e3fd; --border: #e0e3e7;
        }
        @media (prefers-color-scheme: dark) {
            :root { --bg-nav: #1e1f20; --bg-chat: #131314; --text: #e2e2e6; --active: #004a77; --border: #444746; }
        }
        body { font-family: 'Google Sans', sans-serif; margin: 0; display: flex; height: 100vh; background: var(--bg-chat); color: var(--text); overflow: hidden; }

        /* Left Sidebar */
        .sidebar { width: 280px; background: var(--bg-nav); display: flex; flex-direction: column; border-right: 1px solid var(--border); }
        .nav-header { padding: 20px; display: flex; align-items: center; justify-content: space-between; }
        .back-pill { text-decoration: none; font-size: 12px; background: rgba(0,0,0,0.1); padding: 6px 12px; border-radius: 20px; color: inherit; transition: 0.2s; }
        .back-pill:hover { background: rgba(0,0,0,0.2); }

        .session-list { flex: 1; overflow-y: auto; padding: 10px; display: flex; flex-direction: column; gap: 5px; }
        .session-item { padding: 12px 16px; border-radius: 50px; cursor: pointer; font-size: 14px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; transition: 0.2s; display: flex; align-items: center; gap: 10px; }
        .session-item:hover { background: rgba(0,0,0,0.05); }
        .session-item.active { background: var(--active); font-weight: 500; }

        /* Chat Window */
        .chat-frame { flex: 1; display: flex; flex-direction: column; position: relative; }
        .chat-topbar { padding: 15px 25px; border-bottom: 1px solid var(--border); font-size: 16px; font-weight: 500; }
        
        .messages-container { flex: 1; overflow-y: auto; padding: 40px 15%; display: none; flex-direction: column; gap: 30px; }
        .messages-container.visible { display: flex; }

        /* Message Logic */
        .msg-block { display: flex; gap: 15px; line-height: 1.6; }
        .avatar { width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px; flex-shrink: 0; }
        .user-avatar { background: #5f6368; color: white; }
        .ai-avatar { background: linear-gradient(135deg, #4285f4, #d96570); color: white; }
        
        .msg-content { flex: 1; font-size: 15px; }
        .msg-role { font-size: 12px; font-weight: 700; margin-bottom: 4px; opacity: 0.7; }

        .empty-state { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; opacity: 0.5; }
    </style>
</head>
<body>
    <div class="sidebar">
        <div class="nav-header">
            <span style="font-weight: 500;">Chat History</span>
            <a href="/admin/analytics" class="back-pill">Exit</a>
        </div>
        <div class="session-list">
            {% for chat in chats %}
            <div class="session-item" onclick="loadSession('chat-{{ chat.id }}', this)">
                <span class="material-symbols-outlined" style="font-size: 18px;">chat_bubble_outline</span>
                Session {{ chat.id }}
            </div>
            {% endfor %}
        </div>
    </div>

    <div class="chat-frame">
        <div class="chat-topbar" id="topbar">Select a session</div>

        {% for chat in chats %}
        <div class="messages-container" id="chat-{{ chat.id }}" data-title="Session: {{ chat.session_id }}">
            {% for msg in chat.messages %}
            <div class="msg-block">
                {% if msg.role == 'user' %}
                <div class="avatar user-avatar">U</div>
                {% else %}
                <div class="avatar ai-avatar">âœ¨</div>
                {% endif %}
                <div class="msg-content">
                    <div class="msg-role">{{ msg.role|upper }}</div>
                    {{ msg.content }}
                </div>
            </div>
            {% endfor %}
        </div>
        {% endfor %}

        <div class="empty-state" id="emptyState">
            <span class="material-symbols-outlined" style="font-size: 48px">forum</span>
            <p>Select a conversation to review details</p>
        </div>
    </div>

    <script>
        function loadSession(id, btn) {
            // UI Reset
            document.querySelectorAll('.messages-container').forEach(el => el.classList.remove('visible'));
            document.querySelectorAll('.session-item').forEach(el => el.classList.remove('active'));
            document.getElementById('emptyState').style.display = 'none';

            // Activate Target
            const target = document.getElementById(id);
            if(target) {
                target.classList.add('visible');
                document.getElementById('topbar').innerText = target.getAttribute('data-title');
            }
            btn.classList.add('active');
        }
    </script>
</body>
</html>